@tailwind base;
@tailwind components;
@tailwind utilities;

:root {
  --bg: 255 255 255;
  --fg: 17 24 39; /* gray-900 */
}

html, body {
  @apply bg-white text-gray-900 font-body antialiased;
}

h1, h2, h3, h4, h5, h6 {
  @apply font-display text-gray-900;
}

a {
  @apply text-brand-600 hover:text-brand-700 underline-offset-2 hover:underline;
}

.prose :where(a):not(:where([class~="not-prose"] *)) {
  @apply text-brand-600 hover:text-brand-700;
}

.btn-primary {
  @apply inline-flex items-center justify-center rounded-md bg-brand-500 px-4 py-2 text-white shadow-sm hover:bg-brand-600 transition-colors;
}

.card {
  @apply rounded-xl border border-pink-100 bg-pink-50/60 p-4 shadow-sm;
}

/* TipTap / ProseMirror */
.ProseMirror p.is-editor-empty:first-child::before {
  content: attr(data-placeholder);
  float: left;
  color: #9ca3af; /* gray-400 */
  pointer-events: none;
  height: 0;
}

:where(.ProseMirror, .prose) img {
  max-width: 100%;
  height: auto;
}

:where(.ProseMirror, .prose) figure {
  margin: 0.75rem 0;
}

:where(.prose) figure[data-figure-image="true"] {
  display: inline-block;
  vertical-align: top;
  max-width: 100%;
  margin: 0.75rem 0.75rem 0.75rem 0;
}

:where(.prose) figure[data-figure-image="true"][data-align="center"],
:where(.prose) figure[data-figure-image="true"][data-align="right"] {
  display: block;
  margin-right: 0;
}

:where(.prose) figure[data-figure-image="true"][data-align="center"] {
  margin-left: auto;
  margin-right: auto;
}

:where(.prose) figure[data-figure-image="true"][data-align="right"] {
  margin-left: auto;
  margin-right: 0;
}

:where(.ProseMirror, .prose) figure img {
  display: block;
}

:where(.ProseMirror, .prose) img[data-seichi-full] {
  cursor: zoom-in;
}

:where(.ProseMirror, .prose) img[data-seichi-blur="true"] {
  filter: blur(18px);
  transform: scale(1.02);
  transition: filter 200ms ease, transform 200ms ease;
}

:where(.ProseMirror, .prose) img[data-seichi-blur="false"] {
  filter: none;
  transform: none;
}

:where(.ProseMirror, .prose) [data-figure-image-frame] {
  display: inline-block;
  max-width: 100%;
}

:where(.ProseMirror, .prose) [data-figure-image-frame][data-mode="plain"] > img {
  position: static;
  width: 100%;
  height: auto;
  max-width: 100%;
}

:where(.ProseMirror, .prose) [data-figure-image-frame][data-mode="transform"] {
  position: relative;
  overflow: hidden;
  border-radius: 0.5rem;
}

:where(.ProseMirror, .prose) [data-figure-image-frame][data-mode="transform"] > img {
  position: absolute;
  top: 50%;
  left: 50%;
  width: var(--seichi-w, 100%);
  height: var(--seichi-h, 100%);
  max-width: none;
  max-height: none;
  transform: translate(-50%, -50%) rotate(var(--seichi-rot, 0deg)) scaleX(var(--seichi-flip-x, 1)) scaleY(var(--seichi-flip-y, 1));
  transform-origin: center;
  object-fit: contain;
  object-position: center;
}

:where(.ProseMirror, .prose) [data-figure-image-frame][data-mode="transform"] > img[data-crop-l],
:where(.ProseMirror, .prose) [data-figure-image-frame][data-mode="transform"] > img[data-crop-t],
:where(.ProseMirror, .prose) [data-figure-image-frame][data-mode="transform"] > img[data-crop-r],
:where(.ProseMirror, .prose) [data-figure-image-frame][data-mode="transform"] > img[data-crop-b] {
  top: var(--seichi-crop-top, 0%);
  left: var(--seichi-crop-left, 0%);
  width: var(--seichi-crop-width, 100%);
  height: var(--seichi-crop-height, 100%);
  transform: rotate(var(--seichi-rot, 0deg)) scaleX(var(--seichi-flip-x, 1)) scaleY(var(--seichi-flip-y, 1));
  object-fit: cover;
}

:where(.ProseMirror, .prose) [data-figure-image-container] {
  max-width: 100%;
}

:where(.ProseMirror, .prose) figure[data-align="center"] > [data-figure-image-container] {
  margin-left: auto;
  margin-right: auto;
}

:where(.ProseMirror, .prose) figure[data-align="right"] > [data-figure-image-container] {
  margin-left: auto;
  margin-right: 0;
}

:where(.ProseMirror, .prose) figure[data-align="center"] img {
  margin-left: auto;
  margin-right: auto;
}

:where(.ProseMirror, .prose) figure[data-align="right"] img {
  margin-left: auto;
  margin-right: 0;
}

:where(.ProseMirror, .prose) figcaption {
  font-size: 0.875rem;
  line-height: 1.25rem;
  color: #6b7280; /* gray-500 */
}

:where(.ProseMirror, .prose) figure[data-align="center"] figcaption {
  text-align: center;
}

:where(.ProseMirror, .prose) figure[data-align="right"] figcaption {
  text-align: right;
}

:where(.ProseMirror) [data-figure-caption][data-empty="true"]::before {
  content: attr(data-placeholder);
  float: left;
  color: #9ca3af; /* gray-400 */
  pointer-events: none;
  height: 0;
}

:where(.ProseMirror, .prose) pre {
  background: #f3f4f6; /* gray-100 */
  border-radius: 0.5rem;
  padding: 0.75rem 1rem;
  overflow-x: auto;
}

:where(.ProseMirror, .prose) blockquote {
  border-left: 4px solid #f9a8d4; /* pink-300 */
  padding-left: 1rem;
  color: #374151; /* gray-700 */
}

/* Seichi route embed */
.seichi-route {
  @apply my-6 rounded-xl border border-pink-100 bg-pink-50/60 p-4 shadow-sm;
}

.seichi-route__map {
  @apply flex justify-center;
}

.seichi-route__map-card {
  @apply relative w-full max-w-2xl overflow-hidden rounded-lg border border-pink-100 bg-white shadow-sm;
  aspect-ratio: 16 / 9;
}

.seichi-route__map-img {
  @apply h-full w-full object-cover;
  display: block;
}

.seichi-route__map-primary {
  @apply absolute inset-0;
  z-index: 1;
}

.seichi-route__map-cta {
  @apply absolute bottom-2 right-2 rounded-md bg-white/90 px-2 py-1 text-xs font-semibold text-gray-800 shadow;
  z-index: 2;
  pointer-events: none;
}

.seichi-route__map-segments {
  @apply absolute left-2 top-2 flex flex-wrap gap-1;
  z-index: 3;
}

.seichi-route__map-segment {
  @apply rounded-md bg-white/90 px-2 py-1 text-xs font-medium text-gray-800 shadow hover:bg-white;
}

.seichi-route__svg {
  @apply h-auto w-full max-w-sm;
}

.seichi-route__list {
  @apply mt-4 overflow-x-auto;
}

.seichi-route__table {
  @apply w-full border-collapse text-sm;
}

.seichi-route__table th,
.seichi-route__table td {
  @apply border-b border-pink-100 px-3 py-2 align-top;
}

.seichi-route__table th {
  @apply bg-white/60 text-left font-semibold text-gray-700;
}

.seichi-route__table td:first-child {
  @apply whitespace-nowrap text-gray-500;
}

/* Seichi route editor node */
.seichi-route-node__toolbar {
  @apply mb-2 flex items-center gap-2;
}

.seichi-route-node__btn {
  @apply rounded-md border border-gray-200 bg-white px-2 py-1 text-xs font-medium text-gray-700 hover:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-50;
}

.seichi-route-node__btn--primary {
  @apply border-brand-500 bg-brand-500 text-white hover:bg-brand-600;
}

.seichi-route-node__preview {
  @apply cursor-pointer;
}

.seichi-route-node__modal {
  @apply fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-4;
}

.seichi-route-node__modal-card {
  @apply w-full max-w-2xl rounded-xl border border-gray-200 bg-white p-4 shadow-xl;
}

.seichi-route-node__modal-title {
  @apply text-sm font-semibold text-gray-900;
}

.seichi-route-node__textarea {
  @apply mt-3 h-64 w-full rounded-md border border-gray-200 bg-white px-3 py-2 font-mono text-xs outline-none focus:border-brand-400;
}

.seichi-route-node__error {
  @apply mt-2 rounded-md bg-rose-50 p-2 text-xs text-rose-700;
}

.seichi-route-node__hint {
  @apply mt-2 text-xs text-gray-500;
}

.seichi-route-node__modal-actions {
  @apply mt-3 flex justify-end gap-2;
}

/* Rich text typography (Notion/Feishu-ish) */
:where(.ProseMirror, .prose) h1 {
  font-size: 1.875rem; /* text-3xl */
  line-height: 2.25rem;
  font-weight: 700;
  margin: 1.25rem 0 0.75rem;
}

:where(.ProseMirror, .prose) h2 {
  font-size: 1.5rem; /* text-2xl */
  line-height: 2rem;
  font-weight: 700;
  margin: 1.1rem 0 0.6rem;
}

:where(.ProseMirror, .prose) h3 {
  font-size: 1.25rem; /* text-xl */
  line-height: 1.75rem;
  font-weight: 700;
  margin: 1rem 0 0.5rem;
}

:where(.ProseMirror, .prose) p {
  margin: 0.5rem 0;
}

:where(.ProseMirror, .prose) ul {
  list-style: disc;
  padding-left: 1.5rem;
  margin: 0.5rem 0;
}

:where(.ProseMirror, .prose) ol {
  list-style: decimal;
  padding-left: 1.5rem;
  margin: 0.5rem 0;
}

:where(.ProseMirror, .prose) li {
  margin: 0.25rem 0;
}

:where(.ProseMirror, .prose) code {
  background: #f3f4f6; /* gray-100 */
  border-radius: 0.375rem;
  padding: 0.1rem 0.3rem;
  font-size: 0.9em;
}

:where(.ProseMirror, .prose) pre code {
  background: transparent;
  border-radius: 0;
  padding: 0;
  font-size: inherit;
}

/* Rich text block layout (align + indent) */
:where(.ProseMirror, .prose) [data-align="center"] {
  text-align: center;
}

:where(.ProseMirror, .prose) [data-align="right"] {
  text-align: right;
}

:where(.ProseMirror, .prose) [data-indent="1"] { margin-left: 24px; }
:where(.ProseMirror, .prose) [data-indent="2"] { margin-left: 48px; }
:where(.ProseMirror, .prose) [data-indent="3"] { margin-left: 72px; }
:where(.ProseMirror, .prose) [data-indent="4"] { margin-left: 96px; }
:where(.ProseMirror, .prose) [data-indent="5"] { margin-left: 120px; }
:where(.ProseMirror, .prose) [data-indent="6"] { margin-left: 144px; }

:where(.ProseMirror, .prose) img[data-align][data-indent="1"] { transform: translateX(24px); }
:where(.ProseMirror, .prose) img[data-align][data-indent="2"] { transform: translateX(48px); }
:where(.ProseMirror, .prose) img[data-align][data-indent="3"] { transform: translateX(72px); }
:where(.ProseMirror, .prose) img[data-align][data-indent="4"] { transform: translateX(96px); }
:where(.ProseMirror, .prose) img[data-align][data-indent="5"] { transform: translateX(120px); }
:where(.ProseMirror, .prose) img[data-align][data-indent="6"] { transform: translateX(144px); }

:where(.ProseMirror, .prose) img[data-align="center"] {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

:where(.ProseMirror, .prose) img[data-align="right"] {
  display: block;
  margin-left: auto;
  margin-right: 0;
}
